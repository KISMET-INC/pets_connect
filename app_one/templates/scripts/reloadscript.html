<script>
    
    var url_location = '{{location}}'
    var image = '{{image.id}}'
    var trig = '{{trigger}}'
    var img_id = trig.slice(1)
    var img = `.open_modal${img_id}`
    var stats = `#stat${img_id}`
    

        $(window).on("scroll", function() {
            var position = $(window).scrollTop()
            localStorage.setItem('positionY', position)
            console.log(localStorage.getItem("positionY"))
        });

        $(window).on('load', function() {
            if(localStorage.getItem('positionY')){
                var pos = localStorage.getItem('positionY')
                $("html, body").animate({ scrollTop: `${pos}px` },1000);
            
        }})


    if ('{{trigger}}' == '1'){
        $('#comment_modal').addClass('fade'); 
    } else {
        $('#comment_modal').removeClass('fade');
    }
    

    if (image != 0 ){
        $('#comment_modal').modal('show');
        
    }

    // Bulletin is different because the click target is not buried inside the .dimage
    if(url_location == 'bulletin'){
        $( 'p button').mouseover(function() {
            var img_id = $(this).attr('id');
            loadurl =`/${url_location}/{{session_user.id}}/${img_id}/0`
        }).click(function() {
            window.history.pushState({}, '', loadurl)
            window.location.reload();
        })

    }

    $("#comment_modal").on('hidden.bs.modal', function(e){
            loadurl = `/${url_location}/{{session_user.id}}/0/0`
            window.history.pushState({}, '', loadurl)
            $('#comment_modal').addclass('fade');
    });
    

            
    $( '.dimage' )
    .mouseover(function() {
        var img_id = $(this).attr('id');
        var img = `.open_modal${img_id}`
        var stats = `#stat${img_id}`
        loadurl = `/${url_location}/{{session_user.id}}/${img_id}`

        $(".opacity").css('opacity', '.99');

        $( `${img}`).css('opacity', '.6') .click(function(){
            window.history.pushState({}, '', loadurl+'/1')
            window.location.reload()          
        });
        $( `${img}x`).click(function(){
            window.history.pushState({}, '', loadurl+'/1')
            window.location.reload()          
        });

        $(`${stats}`).show()
    });

    $( ".dimage" )
        .mouseleave(function() {
        var id = $(this).attr('id');
        var stats = `#stat${id}`
        var img = `.open_modal${id}`
        $( `${img}`).css('opacity', '1')
        $(`${stats}`).hide()
    });
    
</script>