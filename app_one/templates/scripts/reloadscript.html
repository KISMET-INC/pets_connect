<script>

    var url_location = '{{location}}'
    var image = '{{image.id}}'
    var trig = '{{trigger}}'
    var img_id = trig.slice(1)
    var img = `.open_modal${img_id}`
    var stats = `#stat${img_id}`
    

        // $(window).on("scroll", function() {
        //     var position = $(window).scrollTop()
        //     localStorage.setItem('positionY', position)
        //     console.log(localStorage.getItem("positionY"))
        // });

        // $(window).on('load', function() {
        //     if(localStorage.getItem('positionY')){
        //         var pos = localStorage.getItem('positionY')
        //         $("html, body").animate({ scrollTop: `${pos}px` },1000);
            
        // }})


    if ('{{trigger}}' == '1'){
        $('#comment_modal').addClass('fade'); 
    } else {
        $('#comment_modal').removeClass('fade');
    }
    

    if (image != 0 ){
        $('#comment_modal').modal('show');
        
    }

    // Bulletin is different because the click target is not buried inside the .dimage
    if(url_location == 'bulletin'){
        $( 'p button').mouseover(function() {
            var img_id = $(this).attr('id');
            loadurl =`/${url_location}/{{session_user.id}}/${img_id}/0`
        }).click(function() {
            window.history.pushState({}, '', loadurl)
            window.location.reload();
        })

    }

    $("#comment_modal").on('hidden.bs.modal', function(e){
            loadurl = `/${url_location}/{{session_user.id}}/0/0`
            window.history.pushState({}, '', loadurl)
            $('#comment_modal').addclass('fade');
    });
            var heart=false;

          

            

        $('.dimage').click(function(){

            var img_id = $(this).attr('id');
            var replace = `#replace${img_id}`
            if(heart == true){
                $.ajax({
                cache: false,
                type:"GET",
                url: `/process_heart/${img_id}/{{location}}`,
                })
                .done(function(data){
                    heart=false;
                    $(`#replace${img_id}`).html(data);                    
                })
                .fail(function(data){
                    console.log("Error in fetching data");
                })
            }
            
        })
    
            var num1 = 1
            var num2 = 1
   
    $( '.dimage' ).mouseenter(function() {
        $('.fa-heart').mouseenter(function(){
            num2++;
            heart = true;
            $(this).css('opacity', '.5')
            console.log(heart)
            
        })

        $('.fa-heart').mouseleave(function(){
            heart = false;
            console.log(heart)
            $(this).css('opacity', '1')
        })

      
        var img_id = $(this).attr('id');
        var img = `.open_modal${img_id}`
        var stats = `#stat${img_id}`
        var replace = `#replace${img_id}`
        loadurl = `/${url_location}/{{session_user.id}}/${img_id}`

        $(".opacity").css('opacity', '.99');

        $( `${img}`).css('opacity', '.6') .click(function(){
            window.history.pushState({}, '', loadurl+'/1')
            window.location.reload()          
        });

        $( `${img}x`).css('opacity', '.6') .click(function(){
            window.history.pushState({}, '', loadurl+'/1')
            window.location.reload()          
        });
        
         $(`${stats}`).show()
         console.log('num1 - '+ num1)
         console.log('num2 - '+num2)
    });

    $( ".dimage" )
        .mouseleave(function() {
        var id = $(this).attr('id');
        var stats = `#stat${id}`
        var img = `.open_modal${id}`
        $( `${img}`).css('opacity', '1')
        $(`${stats}`).hide()
    });

  

</script>